<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SpeechToTextV1  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="SpeechToTextV1  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">SpeechToTextV1 4.2.1 Docs</a> (83% documented)</p>
        <p class="header-right"><a href="https://github.com/watson-developer-cloud/swift-sdk"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">SpeechToTextV1 Reference</a>
        <img id="carat" src="img/carat.png" />
        SpeechToTextV1  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/SpeechToText.html">SpeechToText</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AcousticModel.html">AcousticModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AcousticModel/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AcousticModels.html">AcousticModels</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioDetails.html">AudioDetails</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioDetails/TypeEnum.html">– TypeEnum</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioDetails/Compression.html">– Compression</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioListing.html">AudioListing</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioListing/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioMetrics.html">AudioMetrics</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioMetricsDetails.html">AudioMetricsDetails</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioMetricsHistogramBin.html">AudioMetricsHistogramBin</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioResource.html">AudioResource</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioResource/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AudioResources.html">AudioResources</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Corpora.html">Corpora</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Corpus.html">Corpus</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Corpus/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CustomWord.html">CustomWord</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Grammar.html">Grammar</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Grammar/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Grammars.html">Grammars</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/KeywordResult.html">KeywordResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/LanguageModel.html">LanguageModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/LanguageModel/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/LanguageModels.html">LanguageModels</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ProcessedAudio.html">ProcessedAudio</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ProcessingMetrics.html">ProcessingMetrics</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RecognitionJob.html">RecognitionJob</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RecognitionJob/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RecognitionJobs.html">RecognitionJobs</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RecognitionSettings.html">RecognitionSettings</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RecognizeCallback.html">RecognizeCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RegisterStatus.html">RegisterStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RegisterStatus/Status.html">– Status</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeakerLabelsResult.html">SpeakerLabelsResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechModel.html">SpeechModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechModels.html">SpeechModels</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechRecognitionAlternative.html">SpeechRecognitionAlternative</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechRecognitionResult.html">SpeechRecognitionResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechRecognitionResult/EndOfUtterance.html">– EndOfUtterance</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechRecognitionResults.html">SpeechRecognitionResults</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpeechRecognitionResultsAccumulator.html">SpeechRecognitionResultsAccumulator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SupportedFeatures.html">SupportedFeatures</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TrainingResponse.html">TrainingResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TrainingWarning.html">TrainingWarning</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TrainingWarning/Code.html">– Code</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Word.html">Word</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/WordAlternativeResult.html">WordAlternativeResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/WordAlternativeResults.html">WordAlternativeResults</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/WordConfidence.html">WordConfidence</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/WordError.html">WordError</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/WordTimestamp.html">WordTimestamp</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Words.html">Words</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV119WatsonAuthenticatora">WatsonAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV124WatsonBasicAuthenticatora">WatsonBasicAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV130WatsonBearerTokenAuthenticatora">WatsonBearerTokenAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV134WatsonCloudPakForDataAuthenticatora">WatsonCloudPakForDataAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV111WatsonErrora">WatsonError</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV122WatsonIAMAuthenticatora">WatsonIAMAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV110WatsonJSONa">WatsonJSON</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV125WatsonNoAuthAuthenticatora">WatsonNoAuthAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV114WatsonResponsea">WatsonResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:14SpeechToTextV130WatsonTokenSourceAuthenticatora">WatsonTokenSourceAuthenticator</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='speech-to-text' class='heading'>Speech to Text</h1>

<ul>
<li><a href="https://cloud.ibm.com/apidocs/speech-to-text?code=swift">IBM Watson Speech to Text - API Reference</a></li>
<li><a href="https://cloud.ibm.com/docs/speech-to-text/index.html">IBM Watson Speech to Text - Documentation</a></li>
<li><a href="https://www.ibm.com/cloud/watson-speech-to-text">IBM Watson Speech to Text - Service Page</a></li>
</ul>

<p>The IBM Watson Speech to Text service enables you to add speech transcription capabilities to your application. It uses machine intelligence to combine information about grammar and language structure to generate an accurate transcription. Transcriptions are supported for various audio formats and languages.</p>

<p><strong>IMPORTANT:</strong> Please be sure to include both <code>SpeechToTextV1.framework</code> and <code>Starscream.framework</code> in your application. Starscream is a recursive dependency that adds support for WebSockets sessions.</p>

<p>The following example shows how to transcribe an audio file using the standard API endpoint.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SpeechToTextV1</span>

<span class="k">let</span> <span class="nv">authenticator</span> <span class="o">=</span> <span class="kt">WatsonIAMAuthenticator</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="s">"{apikey}"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">speechToText</span> <span class="o">=</span> <span class="kt">SpeechToText</span><span class="p">(</span><span class="nv">authenticator</span><span class="p">:</span> <span class="n">authenticator</span><span class="p">)</span>
<span class="n">speechToText</span><span class="o">.</span><span class="n">serviceURL</span> <span class="o">=</span> <span class="s">"{url}"</span>

<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"audio-file2"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"flac"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">audio</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="o">!</span><span class="p">)</span>

<span class="n">speechToText</span><span class="o">.</span><span class="nf">recognize</span><span class="p">(</span>
  <span class="nv">audio</span><span class="p">:</span> <span class="n">audio</span><span class="p">,</span>
  <span class="nv">keywords</span><span class="p">:</span> <span class="p">[</span><span class="s">"colorado"</span><span class="p">,</span> <span class="s">"tornado"</span><span class="p">,</span> <span class="s">"tornadoes"</span><span class="p">],</span>
  <span class="nv">keywordsThreshold</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
  <span class="nv">wordAlternativesThreshold</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>
  <span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/flac"</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>

  <span class="k">guard</span> <span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="n">response</span><span class="p">?</span><span class="o">.</span><span class="n">result</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">?</span><span class="o">.</span><span class="n">localizedDescription</span> <span class="p">??</span> <span class="s">"unknown error"</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="nf">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>For details on all API operations, including Swift examples, <a href="https://cloud.ibm.com/apidocs/speech-to-text?code=swift">see the API reference.</a></p>
<h2 id='recognizing-audio-using-websockets' class='heading'>Recognizing audio using websockets</h2>

<p>The Swift SDK extends the <code>Starcream</code> library to offer websocket support for recognizing audio.</p>

<p>You can transcribe audio using web sockets by calling the <code>recognizeUsingWebSockets</code> method on the <code><a href="Classes/SpeechToText.html">SpeechToText</a></code> class, as shown in this example.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SpeechToTextV1</span>

<span class="k">let</span> <span class="nv">authenticator</span> <span class="o">=</span> <span class="kt">WatsonIAMAuthenticator</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="s">"{apikey}"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">speechToText</span> <span class="o">=</span> <span class="kt">SpeechToText</span><span class="p">(</span><span class="nv">authenticator</span><span class="p">:</span> <span class="n">authenticator</span><span class="p">)</span>
<span class="n">speechToText</span><span class="o">.</span><span class="n">serviceURL</span> <span class="o">=</span> <span class="s">"{url}"</span>

<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"audio-file2"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"flac"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">audio</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="o">!</span>

<span class="k">let</span> <span class="nv">settings</span> <span class="o">=</span> <span class="kt">RecognitionSettings</span><span class="p">(</span><span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/ogg;codecs=opus"</span><span class="p">)</span>

<span class="k">var</span> <span class="nv">callback</span> <span class="o">=</span> <span class="kt">RecognizeCallback</span><span class="p">()</span>

<span class="c1">// register error handler</span>
<span class="n">callback</span><span class="o">.</span><span class="n">onError</span> <span class="o">=</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// handle error in some way</span>
<span class="p">}</span>

<span class="c1">// register result handler</span>
<span class="n">callback</span><span class="o">.</span><span class="n">onResults</span> <span class="o">=</span> <span class="p">{</span> <span class="n">results</span> <span class="k">in</span>
    <span class="c1">// process results in some way</span>
<span class="p">}</span>

<span class="n">speechToText</span><span class="o">.</span><span class="nf">recognizeUsingWebSocket</span><span class="p">(</span><span class="nv">audio</span><span class="p">:</span> <span class="n">fileData</span><span class="p">,</span> <span class="nv">settings</span><span class="p">:</span> <span class="n">settings</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="n">callback</span><span class="p">)</span>
</code></pre>

<p>In the above example, the <code><a href="Structs/RecognitionSettings.html">RecognitionSettings</a></code> struct is used to define the settings for the recognition request. Additional the <code><a href="Structs/RecognizeCallback.html">RecognizeCallback</a></code> struct allows you to register event handlers for web socket events.</p>
<h2 id='recognizing-audio-from-microphone' class='heading'>Recognizing audio from microphone</h2>

<p>If you&rsquo;d like to record audio from a device microphone and trascribe it using Speech to Text, you can use the SDK provided <code>recognizeMicrophone</code> method, as shown in this example.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SpeechToTextV1</span>

<span class="k">let</span> <span class="nv">authenticator</span> <span class="o">=</span> <span class="kt">WatsonIAMAuthenticator</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="s">"{apikey}"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">speechToText</span> <span class="o">=</span> <span class="kt">SpeechToText</span><span class="p">(</span><span class="nv">authenticator</span><span class="p">:</span> <span class="n">authenticator</span><span class="p">)</span>
<span class="n">speechToText</span><span class="o">.</span><span class="n">serviceURL</span> <span class="o">=</span> <span class="s">"{url}"</span>

<span class="k">var</span> <span class="nv">accumulator</span> <span class="o">=</span> <span class="kt">SpeechRecognitionResultsAccumulator</span><span class="p">()</span>

<span class="c1">// this function can be called from a button press or similar action</span>
<span class="c1">// based on user input</span>
<span class="kd">func</span> <span class="nf">startStreaming</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">settings</span> <span class="o">=</span> <span class="kt">RecognitionSettings</span><span class="p">(</span><span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/ogg;codecs=opus"</span><span class="p">)</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">interimResults</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">speechToText</span><span class="o">.</span><span class="nf">recognizeMicrophone</span><span class="p">(</span><span class="nv">settings</span><span class="p">:</span> <span class="n">settings</span><span class="p">)</span> <span class="p">{</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="n">response</span><span class="p">?</span><span class="o">.</span><span class="n">result</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Failed to recognize the audio"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">accumulator</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">results</span><span class="p">:</span> <span class="n">results</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">accumulator</span><span class="o">.</span><span class="n">bestTranscript</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// this function can be called when the user releases a button or a similar action</span>
<span class="kd">func</span> <span class="nf">stopStreaming</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">speechToText</span><span class="o">.</span><span class="nf">stopRecognizeMicrophone</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>The above example uses the <code>recognizeMicrophone</code> method within a function, which can be called from a button click or user input. How you call it is up to you, but the above provides a typical example of how you would record while responding to a UI action.</p>
<h2 id='advanced-usage' class='heading'>Advanced Usage</h2>
<h3 id='microphone-audio-and-compression-in-detail' class='heading'>Microphone Audio and Compression in detail</h3>

<p>The Speech to Text framework makes it easy to perform speech recognition with microphone audio. The framework internally manages the microphone, starting and stopping it with various method calls (<code>recognizeMicrophone</code> and <code>stopRecognizeMicrophone</code>, or <code>startMicrophone</code> and <code>stopMicrophone</code>).</p>

<p>There are two different ways that your app can determine when to stop the microphone:</p>

<ul>
<li><p>User Interaction: Your app could rely on user input to stop the microphone. For example, you could use a button to start/stop transcribing, or you could require users to press-and-hold a button to start/stop transcribing.</p></li>
<li><p>Final Result: Each transcription result has a <code>final</code> property that is <code>true</code> when the audio stream is complete or a timeout has occurred. By watching for the <code>final</code> property, your app can stop the microphone after determining when the user has finished speaking.</p></li>
</ul>

<p>To reduce latency and bandwidth, the microphone audio is compressed to OggOpus format by default. To disable compression, set the <code>compress</code> parameter to <code>false</code>.</p>

<p>It&rsquo;s important to specify the correct audio format for recognition requests that use the microphone:</p>
<pre class="highlight swift"><code><span class="c1">// compressed microphone audio uses the opus format</span>
<span class="k">let</span> <span class="nv">settings</span> <span class="o">=</span> <span class="kt">RecognitionSettings</span><span class="p">(</span><span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/ogg;codecs=opus"</span><span class="p">)</span>

<span class="c1">// uncompressed microphone audio uses a 16-bit mono PCM format at 16 kHz</span>
<span class="k">let</span> <span class="nv">settings</span> <span class="o">=</span> <span class="kt">RecognitionSettings</span><span class="p">(</span><span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/l16;rate=16000;channels=1"</span><span class="p">)</span>
</code></pre>
<h3 id='recognition-results-accumulator-in-detail' class='heading'>Recognition Results Accumulator in detail</h3>

<p>The Speech to Text service may not always return the entire transcription in a single response. Instead, the transcription may be streamed over multiple responses, each with a chunk of the overall results. This is especially common for long audio files, since the entire transcription may contain a significant amount of text.</p>

<p>To help combine multiple responses, the Swift SDK provides a <code><a href="Structs/SpeechRecognitionResultsAccumulator.html">SpeechRecognitionResultsAccumulator</a></code> object. The accumulator tracks results as they are added and maintains several useful instance variables:
    - <code>results</code>: A list of all accumulated recognition results.
    - <code>speakerLabels</code>: A list of all accumulated speaker labels.
    - <code>bestTranscript</code>: A concatenation of transcripts with the greatest confidence.</p>

<p>To use the accumulator, initialize an instance of the object then add results as you receive them:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">accumulator</span> <span class="o">=</span> <span class="kt">SpeechRecognitionResultsAccumulator</span><span class="p">()</span>
<span class="n">accumulator</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">results</span><span class="p">:</span> <span class="n">results</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">accumulator</span><span class="o">.</span><span class="n">bestTranscript</span><span class="p">)</span>
</code></pre>
<h3 id='session-management-and-advanced-features' class='heading'>Session Management and Advanced Features</h3>

<p>Advanced users may want more customizability than provided by the <code><a href="Classes/SpeechToText.html">SpeechToText</a></code> class. The <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code> class exposes more control over the WebSockets connection and also includes several advanced features for accessing the microphone. The <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code> class also allows users more control over the AVAudioSession shared instance. Before using <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code>, it&rsquo;s helpful to be familiar with the <a href="https://cloud.ibm.com/docs/services/speech-to-text/websockets.html">Speech to Text WebSocket interface</a>.</p>

<p>The following steps describe how to execute a recognition request with <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code>:</p>

<ol>
<li>Connect: Invoke <code>connect()</code> to connect to the service.</li>
<li>Start Recognition Request: Invoke <code>startRequest(settings:)</code> to start a recognition request.</li>
<li>Send Audio: Invoke <code>recognize(audio:)</code> or <code>startMicrophone(compress:)</code>/<code>stopMicrophone()</code> to send audio to the service.</li>
<li>Stop Recognition Request: Invoke <code>stopRequest()</code> to end the recognition request. If the recognition request is already stopped, then sending a stop message will have no effect.</li>
<li>Disconnect: Invoke <code>disconnect()</code> to wait for any remaining results to be received and then disconnect from the service.</li>
</ol>

<p>All text and data messages sent by <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code> are queued, with the exception of <code>connect()</code> which immediately connects to the server. The queue ensures that the messages are sent in-order and also buffers messages while waiting for a connection to be established. This behavior is generally transparent.</p>

<p>A <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code> also provides several (optional) callbacks. The callbacks can be used to learn about the state of the session or access microphone data.</p>

<ul>
<li><code>onConnect</code>: Invoked when the session connects to the Speech to Text service.</li>
<li><code>onMicrophoneData</code>: Invoked with microphone audio when a recording audio queue buffer has been filled. If microphone audio is being compressed, then the audio data is in OggOpus format. If uncompressed, then the audio data is in 16-bit PCM format at 16 kHz.</li>
<li><code>onPowerData</code>: Invoked every 0.025s when recording with the average dB power of the microphone.</li>
<li><code>onResults</code>: Invoked when transcription results are received for a recognition request.</li>
<li><code>onError</code>: Invoked when an error or warning occurs.</li>
<li><code>onDisconnect</code>: Invoked when the session disconnects from the Speech to Text service.</li>
</ul>

<p>Note that the <code>AVAudioSession.sharedInstance()</code> must be configured to allow microphone access when using <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code>. This allows users to set a particular configuration for the <code>AVAudioSession</code>. An example configuration is shown in the code below.</p>

<p>The following example demonstrates how to use <code><a href="Classes/SpeechToTextSession.html">SpeechToTextSession</a></code> to transcribe microphone audio:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SpeechToTextV1</span>

<span class="k">let</span> <span class="nv">authenticator</span> <span class="o">=</span> <span class="kt">WatsonIAMAuthenticator</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="s">"{apikey}"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">speechToTextSession</span> <span class="o">=</span> <span class="kt">SpeechToTextSession</span><span class="p">(</span><span class="nv">authenticator</span><span class="p">:</span> <span class="n">authenticator</span><span class="p">)</span>

<span class="k">var</span> <span class="nv">accumulator</span> <span class="o">=</span> <span class="kt">SpeechRecognitionResultsAccumulator</span><span class="p">()</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span>
    <span class="k">try</span> <span class="n">session</span><span class="o">.</span><span class="nf">setCategory</span><span class="p">(</span><span class="kt">AVAudioSession</span><span class="o">.</span><span class="kt">Category</span><span class="o">.</span><span class="n">playAndRecord</span><span class="p">,</span> <span class="nv">mode</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">defaultToSpeaker</span><span class="p">,</span> <span class="o">.</span><span class="n">mixWithOthers</span><span class="p">])</span>
    <span class="k">try</span> <span class="n">session</span><span class="o">.</span><span class="nf">setActive</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">startStreaming</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// define callbacks</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onConnect</span> <span class="o">=</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"connected"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onDisconnect</span> <span class="o">=</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"disconnected"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onError</span> <span class="o">=</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onPowerData</span> <span class="o">=</span> <span class="p">{</span> <span class="n">decibels</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="n">decibels</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onMicrophoneData</span> <span class="o">=</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="s">"received data"</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="n">onResults</span> <span class="o">=</span> <span class="p">{</span> <span class="n">results</span> <span class="k">in</span>
        <span class="n">accumulator</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">results</span><span class="p">:</span> <span class="n">results</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">accumulator</span><span class="o">.</span><span class="n">bestTranscript</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// define recognition request settings</span>
    <span class="k">var</span> <span class="nv">settings</span> <span class="o">=</span> <span class="kt">RecognitionSettings</span><span class="p">(</span><span class="nv">contentType</span><span class="p">:</span> <span class="s">"audio/ogg;codecs=opus"</span><span class="p">)</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">interimResults</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="c1">// start streaming microphone audio for transcription</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">startRequest</span><span class="p">(</span><span class="nv">settings</span><span class="p">:</span> <span class="n">settings</span><span class="p">)</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">startMicrophone</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">stopStreaming</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">stopMicrophone</span><span class="p">()</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">stopRequest</span><span class="p">()</span>
    <span class="n">speechToTextSession</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>Copyright 2020 IBM</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.7</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
